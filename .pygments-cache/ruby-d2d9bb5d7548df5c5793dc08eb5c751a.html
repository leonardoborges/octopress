<div class="highlight"><pre><span class="k">class</span> <span class="nc">Jphoto</span><span class="o">&lt;</span><span class="n">br</span><span class="o">&gt;</span> <span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">&lt;br</span><span class="o">&gt;&lt;</span><span class="n">br</span><span class="o">&gt;</span> <span class="c1">#a few other methods ...&lt;br&gt;&lt;br&gt; def post_photo(file_data, hotel_id, send_rss, options = {})&lt;br&gt;   file_name = &quot;tmp/#{Time.now.to_i}_#{rand(1000000).to_s(36)}&quot;&lt;br&gt;   File.open(file_name, &quot;wb&quot;) do |f|&lt;br&gt;     f.puts(file_data)&lt;br&gt;   end&lt;br&gt;&lt;br&gt;   params = [Curl::PostField.file(&#39;photo&#39;,file_name),&lt;br&gt;      Curl::PostField.content(&#39;hotel&#39;, hotel_id),&lt;br&gt;      Curl::PostField.content(&#39;source&#39;,&#39;PhotoUploadTest&#39;)]&lt;br&gt;   extract_extra_params!(params, options)&lt;br&gt;&lt;br&gt;   c = Curl::Easy.new(&quot;#{service_uri_base&#39;]}/photoupld&quot;)&lt;br&gt;   c.multipart_form_post = true&lt;br&gt;   c.http_post(*params)&lt;br&gt;&lt;br&gt;   if c.response_code != 200&lt;br&gt;     error_msg = &quot;File upload failed with code: #{c.response_code}&quot;&lt;br&gt;     Rails.logger.info error_msg&lt;br&gt;     raise error_msg&lt;br&gt;   end&lt;br&gt;&lt;br&gt;   File.delete(file_name)&lt;br&gt;&lt;br&gt;   hotel = Hotel.find_by_id(hotel_id)&lt;br&gt;   hotel.cache.destroy_all&lt;br&gt;&lt;br&gt;   send_upload_rss(hotel, original_upload_url(c.body_str) , options) if send_rss&lt;br&gt; end&lt;br&gt;&lt;br&gt; private&lt;br&gt;&lt;br&gt; def send_upload_rss(hotel, photo_url, options)&lt;br&gt;   ...&lt;br&gt; end&lt;br&gt; def manage_images_link(hotel_id)&lt;br&gt;   ...&lt;br&gt; end&lt;br&gt;&lt;br&gt; def extract_extra_params!(params, options)&lt;br&gt;   params &lt;&lt; Curl::PostField.content(&#39;status&#39;, options[:status]) if options[:status]&lt;br&gt;   params &lt;&lt; Curl::PostField.content(&#39;upload_source&#39;, options[:upload_source]) if options[:upload_source]&lt;br&gt;   params &lt;&lt; Curl::PostField.content(&#39;uploader_ip&#39;, options[:uploader_ip]) if options[:uploader_ip]&lt;br&gt;   params &lt;&lt; Curl::PostField.content(&#39;uploader_email&#39;, options[:uploader_email]) if options[:uploader_email]&lt;br&gt; end&lt;br&gt;end</span>
</pre>
</div>
